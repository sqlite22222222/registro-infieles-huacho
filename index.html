<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="b3cerXLZRsj5zefuZazxMyDZZilHhfu2jlDiw27okFA" />
    <title>Registro Provincial de Infieles - Huachito York | Lista Negra</title>
    <meta name="keywords" content="lista de infieles huacho, lista de las girls, lista de las girls huachanas, lista de infieles, lista de infieles de santa maria, lista de infieles de hualmay, huachito york, infieles huacho, registro de infieles">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* [Se mantienen la mayor√≠a de estilos generales, se ajustan los de verificaci√≥n] */
        body { 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #f7f9fc; 
            color: #2c3e50; 
        }
        .container { 
            max-width: 1100px; 
            margin: 40px auto; 
            padding: 20px; 
            text-align: center; 
        }
        .header-title { 
            font-size: 44px; 
            font-weight: 900; 
            margin-bottom: 5px; 
            text-transform: uppercase; 
            text-shadow: 2px 2px 5px rgba(0,0,0,0.1); 
            letter-spacing: 1px;
            background: linear-gradient(90deg, #e74c3c, #f1c40f, #e67e22, #c0392b);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-animation 10s ease infinite;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header-subtitle { 
            font-size: 18px; 
            color: #5d6d7e; 
            margin-bottom: 40px; 
            line-height: 1.6; 
            font-weight: 300;
        }
        .actions { display: flex; justify-content: center; gap: 20px; margin-bottom: 50px; }
        .btn { 
            padding: 15px 30px; 
            border: none; 
            border-radius: 10px; 
            font-weight: 600; 
            font-size: 15px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); 
            text-transform: uppercase;
        }
        .btn-report { background-color: #c0392b; color: white; }
        .btn-report:hover { background-color: #e74c3c; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(192, 57, 43, 0.4); }
        .btn-list { background-color: #f1c40f; color: #2c3e50; }
        .btn-list:hover { background-color: #f39c12; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(241, 196, 15, 0.4); }
        .btn-online { background-color: #2ecc71; color: white; }
        .btn-online:hover { background-color: #27ae60; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4); }
        .top-infieles { margin-bottom: 50px; }
        .top-infieles-title { 
            font-size: 32px; 
            color: #34495e; 
            margin-bottom: 30px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 700;
        }
        .top-infieles-title::before, .top-infieles-title::after { content: "üèÜ"; margin: 0 15px; font-size: 28px; }     
        .medals { display: flex; justify-content: center; gap: 30px; min-height: 250px; } 
        .medal-card { 
            width: 300px; 
            padding: 30px 20px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); 
            position: relative; 
            text-align: center; 
            transform: scale(0.98); 
            transition: transform 0.4s ease-in-out, box-shadow 0.4s; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }
        .medal-card:hover { transform: scale(1.05); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); }
        .medal-1 { 
            background: linear-gradient(145deg, #f7dc6f, #f1c40f);
            color: #333;
        } 
        .medal-2 { 
            background: linear-gradient(145deg, #ecf0f1, #bdc3c7);
            color: #333;
        } 
        .medal-3 { 
            background: linear-gradient(145deg, #e67e22, #d35400);
            color: white;
        } 
        .medal-icon { 
            font-size: 50px; 
            margin-bottom: 10px; 
            display: block; 
            line-height: 1;
        }
        .medal-1 .medal-icon { color: #f39c12; }
        .medal-2 .medal-icon { color: #95a5a6; }
        .medal-3 .medal-icon { color: #a04000; }
        .medal-name { font-size: 26px; font-weight: 700; margin-top: 10px; margin-bottom: 5px; }
        .medal-district { 
            font-size: 14px; 
            color: #5d6d7e; 
            background-color: rgba(255, 255, 255, 0.8); 
            padding: 6px 12px; 
            border-radius: 10px; 
            display: inline-block; 
            margin-top: 10px; 
            font-weight: 600; 
            border: 1px solid #ddd;
        }
        .medal-3 .medal-district { color: #f4f6f7; background-color: rgba(0, 0, 0, 0.3); border: none; }
        
        .medal-votes { 
            font-size: 20px; 
            color: #e74c3c; 
            font-weight: 900; 
            margin-top: 15px; 
            text-shadow: 0 0 5px rgba(231, 76, 60, 0.3);
        }
        .medal-votes::before { content: "üî• "; }
        .empty-slot.medal-1 { background: linear-gradient(145deg, #fff2c8, #ffe580); color: #8a7c1f; }
        .empty-slot.medal-2 { background: linear-gradient(145deg, #f0f0f0, #e0e0e0); color: #7f8c8d; }
        .empty-slot.medal-3 { background: linear-gradient(145deg, #ffb68c, #ff9b5e); color: #fff; }
        .empty-slot .medal-district { background-color: rgba(0, 0, 0, 0.1); color: #8a7c1f; border: none; }
        .empty-slot.medal-2 .medal-district { color: #7f8c8d; }
        .empty-slot.medal-3 .medal-district { background-color: rgba(0, 0, 0, 0.3); color: #fff; }
        .search-section { background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); text-align: left; margin-bottom: 40px; border-top: 5px solid #e74c3c; }
        .search-section h3 { font-size: 28px; color: #c0392b; margin-top: 0; margin-bottom: 25px; border-bottom: 3px solid #e74c3c; display: inline-block; padding-bottom: 8px; font-weight: 700; }
        .search-input-group { display: flex; align-items: center; border: 2px solid #bdc3c7; border-radius: 10px; padding: 10px; margin-bottom: 25px; background-color: #fcfcfc; transition: border-color 0.3s; }
        .search-input-group:focus-within { border-color: #e74c3c; box-shadow: 0 0 5px rgba(231, 76, 60, 0.3); }
        .search-input-group span { margin-right: 15px; color: #e74c3c; font-size: 22px; }
        .search-input-group input { flex-grow: 1; border: none; outline: none; font-size: 17px; background-color: transparent; font-family: 'Poppins', sans-serif; }
        .filters { display: flex; flex-wrap: wrap; justify-content: space-between; gap: 15px; }
        .filter-select { 
            padding: 12px 18px; 
            border: 1px solid #dcdcdc; 
            border-radius: 8px; 
            background-color: #fff; 
            font-size: 15px; 
            cursor: pointer; 
            appearance: none; 
            -webkit-appearance: none; 
            -moz-appearance: none; 
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%232c3e50%22%20d%3D%22M287%20173.5c-4.1%204.1-8.5%206.2-13.3%206.2s-9.2-2.1-13.3-6.2L146.2%2059%2031%20173.5c-4.1%204.1-8.5%206.2-13.3%206.2s-9.2-2.1-13.3-6.2c-8.2-8.2-8.2-21.5%200-29.7l131.2-131.2c8.2-8.2%2021.5-8.2%2029.7%200l131.2%20131.2c8.2%208.2%208.2%2021.5%200%2029.7z%22%2F%3E%3C%2Fsvg%3E'); /* Flecha m√°s oscura */
            background-repeat: no-repeat; 
            background-position: right 10px center; 
            background-size: 12px; 
            padding-right: 35px; 
            flex-grow: 1; 
            min-width: 150px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            font-weight: 500;
        }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); padding-top: 20px; }
        .report-modal-content { 
            background-color: #ffffff; 
            margin: 20px auto; 
            padding: 40px; 
            border-radius: 20px; 
            width: 90%; 
            max-width: 850px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.5); 
            position: relative; 
            text-align: left;
        }
        .report-header { background-color: #fcecec; padding: 20px; border-radius: 15px; margin-bottom: 30px; border-left: 6px solid #e74c3c; }
        .report-header h2 { margin: 0; color: #e74c3c; font-size: 28px; display: flex; align-items: center; gap: 10px; font-weight: 700; }
        .alert-social { color: #c0392b; background-color: #fbecec; padding: 15px; border-radius: 10px; margin-top: 15px; font-weight: 600; border-left: 4px solid #d32f2f; font-size: 15px; }
        .form-section { background-color: #fcfcfc; padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 1px solid #eee; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03); }
        .section-title { font-size: 22px; font-weight: 700; margin-bottom: 20px; color: #34495e; display: flex; align-items: center; gap: 10px; }
        .section-title.pink { background-color: #fff9e6; border-left: 4px solid #f39c12; padding: 10px; border-radius: 8px; }
        .section-title.purple { background-color: #f7f0f8; border-left: 4px solid #9b59b6; padding: 10px; border-radius: 8px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { font-size: 15px; font-weight: 600; color: #5d6d7e; margin-bottom: 8px; }
        .input-group input, .input-group select, .input-group textarea {
            padding: 14px;
            border: 1px solid #bdc3c7;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: #ffffff;
            width: 100%;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus { border-color: #e74c3c; outline: none; box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2); background-color: #fff; }
        .char-count { font-size: 13px; color: #999; margin-top: 5px; }
        .evidence-section { background-color: #fffceb; }
        .evidence-upload-box { border: 2px dashed #f39c12; padding: 20px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; background-color: #fffef6; margin-top: 15px; }
        .file-info { font-size: 15px; color: #5d6d7e; font-weight: 500;}
        .btn-upload-file { background-color: #e67e22; color: white; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        .btn-upload-file:hover { background-color: #d35400; }
        .file-upload-specs { font-size: 13px; color: #8c8c8c; margin-top: 10px; }
        .legal-section { background-color: #fef7f7; border: 1px solid #f0b0b0; }
        .legal-notice { font-size: 17px; font-weight: bold; color: #e74c3c; margin-bottom: 15px; }
        .legal-list { list-style: none; padding-left: 0; margin-bottom: 25px; }
        .legal-list li { margin-bottom: 10px; font-size: 15px; color: #34495e; display: flex; align-items: flex-start; line-height: 1.5; }
        .legal-list li::before { content: "‚Ä¢"; color: #e74c3c; font-weight: bold; display: inline-block; width: 1.5em; margin-left: -1.5em; font-size: 1.2em; }      
        .checkbox-group { margin-bottom: 20px; display: flex; align-items: flex-start; }
        .checkbox-group input[type="checkbox"] { margin-right: 12px; margin-top: 5px; accent-color: #e74c3c; min-width: 16px; min-height: 16px; cursor: pointer; } 
        .checkbox-group label { font-size: 15px; font-weight: normal; color: #34495e; line-height: 1.4; cursor: pointer; }
        
        /* --- ESTILOS DE VERIFICACI√ìN (Nuevos/Modificados) --- */
        .verification-group { 
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #fcfcfc;
        }
        
        .verification-status-box { /* Contenedor general de la verificaci√≥n */
            background-color: #f0f8f0; /* Fondo verde muy claro para la caja */
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #c8e6c9; /* Borde verde claro */
        }

        .status-text { /* Estilo del texto "Verificaci√≥n completada" */
            font-size: 16px;
            font-weight: 600;
            color: #4CAF50; /* Texto verde */
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .status-badge { /* Estilo del "Publicaci√≥n Habilitada" */
            background-color: #d1d5db; /* Fondo gris para el badge deshabilitado/pendiente */
            color: #6b7280; /* Texto gris oscuro */
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            width: fit-content;
        }

        .status-badge.enabled {
            background-color: #dcfce7; /* Fondo verde muy claro para habilitado */
            color: #10b981; /* Texto verde brillante */
        }

        .status-title {
            font-size: 22px; 
            font-weight: 700; 
            color: #34495e; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-bottom: 15px;
        }
        /* --- Fin de Estilos de Verificaci√≥n --- */

        .btn-publish { 
            background-color: #e74c3c; 
            color: white; 
            width: 100%; 
            padding: 20px; 
            border-radius: 12px; 
            font-size: 22px; 
            margin-top: 25px; 
            box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4); 
            transition: background-color 0.3s, transform 0.3s; 
            font-weight: 700;
        }
        .btn-publish:hover { background-color: #c0392b; transform: translateY(-2px); }
        .btn-publish:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .publish-note { font-size: 13px; color: #666; margin-top: 10px; text-align: center; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); padding-top: 20px; }
        .not-found-modal-content { background-color: #f9fbfd; text-align: center; padding: 40px 20px; box-shadow: 0 0 25px rgba(0, 0, 0, 0.2); border-radius: 20px; border-top: 5px solid #2ecc71; }
        .clean-status { font-size: 32px; font-weight: 700; color: #27ae60; margin-bottom: 20px; }
        .shield-icon { display: block; width: 80px; height: 80px; background-color: #ebf5ee; border-radius: 50%; margin: 0 auto 20px; display: flex; justify-content: center; align-items: center; border: 3px solid #2ecc71; }
        .shield-icon svg { fill: #2ecc71; }
        .green-light { font-size: 26px; font-weight: 700; color: #2ecc71; margin-bottom: 15px; }
        .not-found-name { font-style: italic; font-size: 18px; margin-bottom: 25px; color: #34495e; }
        .absence-note { font-size: 15px; color: #5d6d7e; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 30px; }
        .btn-search-other { background-color: #f7f9fc; color: #e74c3c; border: 2px solid #e74c3c; }
        .btn-search-other:hover { background-color: #fae0e0; }
        .btn-close-nf { background-color: #2ecc71; color: white; }
        .modal-actions { display: flex; justify-content: space-around; margin-top: 30px; }
        .modal-actions button { width: 45%; padding: 14px; font-size: 16px; border-radius: 10px; font-weight: 600; }
        .close-btn { color: #aaa; float: right; font-size: 36px; font-weight: bold; position: absolute; top: 10px; right: 20px; }
        .close-btn:hover, .close-btn:focus { color: #555; text-decoration: none; cursor: pointer; }

    </style>
</head>
<body>
    <div class="container">
        <div class="header-title">
            REGISTRO PROVINCIAL DE INFIELES DE HUACHITO YORK üî• 
        </div>
        <div class="header-subtitle">
            ¬°Busca y reporta infieles de Huacho, Hualmay, Huaura, Santa Mar√≠a y m√°s. Encuentra la lista de las 'Girls' y los 'Boys' m√°s votados de la provincia!.<br>‚ò†Ô∏è Huacho pueblo chico, infierno grande ‚ò†Ô∏è
        </div>

        <div class="actions">
            <button class="btn btn-report" id="reportar-btn">
                üó£Ô∏è REPORTAR INFIEL
            </button>
            <button class="btn btn-list">
                <span id="lista-icon">üëÄ</span> <span id="lista-count">0</span> LISTA DE INFIEL<span>ES</span>
            </button>
            <button class="btn btn-online">
                üë• <span id="online-count">60</span> PERSONAS EN L√çNEA
            </button>
        </div>

        <div class="top-infieles">
            <h2 class="top-infieles-title">
                <span style="color: #e74c3c;">INFIELES CON MAYOR N√öMERO DE VOTOS</span>
            </h2>
            <div class="medals" id="top-infieles-container">
            </div>
        </div>

        <div class="search-section">
            <h3>üìã LISTA DE INFIELES</h3>
            
            <div class="search-input-group">
                <span>üîç</span>
                <input type="text" placeholder="Busca a tu infiel aqu√≠..." id="search-input"> 
            </div>

            <div class="filters">
                <select class="filter-select">
                    <option>üìç Todos los Distritos</option>
                    <option>Huacho</option>
                    <option>Hualmay</option>
                    <option>Huaura</option>
                    <option>Santa Mar√≠a</option>
                </select>
                <select class="filter-select">
                    <option>üßë Cualquier Edad</option>
                    <option>-17</option>
                    <option>18-25</option>
                    <option>26-35</option>
                    <option>+35</option>
                </select>
                <select class="filter-select">
                    <option>‚¨áÔ∏è M√°s Recientes</option>
                    <option>M√°s Votados</option>
                    <option>Alfab√©tico</option>
                </select>
            </div>
        </div>

    </div>

    <div id="reportar-modal" class="modal">
        <div class="report-modal-content">
            <span class="close-btn" onclick="cerrarModal('reportar-modal')">&times;</span>
            
            <div class="report-header">
                <h2>‚ö†Ô∏è Reportar Infidelidad</h2>
                <div class="alert-social">
                    <span style="font-weight: bold;">üö® ALERTA SOCIAL:</span> Completa este formulario para registrar p√∫blicamente a una persona infiel. Este proceso es 100% an√≥nimo. Todos los campos marcados con * son obligatorios.
                </div>
            </div>

            <form id="report-form" onsubmit="event.preventDefault(); submitReporteCompleto();">
                <div class="form-section">
                    <div class="section-title purple">
                        <span style="color: #9b59b6;">üë§</span> Informaci√≥n de la Persona Reportada
                    </div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="report-nombre">Nombre *</label>
                            <input type="text" id="report-nombre" placeholder="Ej: Juan" required>
                        </div>
                        <div class="input-group">
                            <label for="report-apellido">Apellido *</label>
                            <input type="text" id="report-apellido" placeholder="Ej: P√©rez Garc√≠a" required>
                        </div>
                        <div class="input-group">
                            <label for="report-edad">Edad *</label>
                            <input type="number" id="report-edad" placeholder="Ej: 25" min="1" required>
                        </div>
                        <div class="input-group">
                            <label for="report-genero">G√©nero (opcional)</label>
                            <select id="report-genero">
                                <option>Selecciona g√©nero</option>
                                <option>Masculino</option>
                                <option>Femenino</option>
                                <option>Otro</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title purple">
                        <span style="color: #9b59b6;">üìç</span> Ubicaci√≥n en Per√∫
                    </div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="report-departamento">Departamento *</label>
                            <select id="report-departamento" required>
                                <option>Selecciona departamento</option>
                                <option selected>Lima</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="report-provincia">Provincia *</label>
                            <select id="report-provincia" required>
                                <option>Selecciona provincia</option>
                                <option selected>Huaura</option>
                            </select>
                        </div>
                        <div class="input-group" style="grid-column: 1 / span 2;">
                            <label for="report-distrito">Distrito *</label>
                            <select id="report-distrito" required>
                                <option value="Selecciona distrito">Selecciona distrito</option>
                                <option>Huacho</option>
                                <option>Hualmay</option>
                                <option>Santa Mar√≠a</option>
                                <option>Huaura</option>
                                </select>
                        </div>
                    </div>
                </div>

                <div class="form-section evidence-section">
                    <div class="section-title pink">
                        <span style="color: #f39c12;">üí¨</span> Testimonio / Motivo del Reporte
                    </div>
                    <div class="input-group">
                        <label for="report-testimonio">Cuenta lo que sucedi√≥</label>
                        <textarea id="report-testimonio" rows="5" placeholder="Describe el motivo del reporte. (Opcional)"></textarea>
                        <div class="char-count" id="testimonio-char-count">0 caracteres (opcional)</div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">
                        <span style="color: #e74c3c;">üé§</span> Evidencias (Opcional)
                    </div>
                    <p style="font-size: 15px; color: #5d6d7e;">Puedes adjuntar capturas de pantalla, fotos, documentos PDF o enlaces como pruebas.</p>
                    
                    <div class="input-group">
                        <label>Subir Archivos (Im√°genes o PDF)</label>
                        <div class="evidence-upload-box">
                            <div class="file-info" id="file-selection-info">Elegir archivos</div>
                            <label for="file-upload" class="btn-upload-file">Elegir archivos</label>
                            <input type="file" id="file-upload" multiple style="display: none;">
                        </div>
                        <div class="file-upload-specs">Formatos permitidos: JPG, PNG, GIF, WebP, PDF. M√°ximo 10MB por archivo.</div>
                    </div>

                    <div class="input-group">
                        <label for="report-enlace">Enlaces externos (URLs)</label>
                        <input type="url" id="report-enlace" placeholder="https://ejemplo.com/evidencia">
                    </div>

                    <div class="input-group">
                        <label for="report-email">Tu correo electr√≥nico (opcional)</label>
                        <input type="email" id="report-email" placeholder="tu@gmail.com (Solo necesario si quieres editar/eliminar despu√©s)">
                        <span style="font-size: 13px; color: #3498db; margin-top: 5px;">‚ÑπÔ∏è Si deseas poder solicitar ediciones o eliminaciones futuras, proporciona un correo Gmail v√°lido.</span>
                    </div>
                </div>

                <div class="form-section legal-section">
                    <div class="section-title">
                        <span style="color: #e74c3c;">‚öñÔ∏è</span> T√©rminos Legales y Responsabilidad
                    </div>
                    <div class="legal-notice">üö® AVISO LEGAL IMPORTANTE:</div>
                    <ul class="legal-list">
                        <li>Este sitio muestra testimonios enviados de forma an√≥nima por usuarios.</li>
                        <li>La informaci√≥n aqu√≠ compartida NO constituye una afirmaci√≥n legal ni una verdad absoluta.</li>
                        <li>Cada usuario es responsable de su testimonio y las consecuencias legales que este pueda generar.</li>
                        <li>Este testimonio NO representa una acusaci√≥n legal ni una sentencia hacia ninguna persona.</li>
                        <li>Los datos pueden ser utilizados con fines informativos y de alerta social.</li>
                    </ul>

                    <div class="checkbox-group">
                        <input type="checkbox" id="legal-1" name="legal-check" onchange="verificarAceptacionLegal()">
                        <label for="legal-1">He le√≠do y acepto que este sitio muestra testimonios an√≥nimos y que la informaci√≥n no constituye una verdad absoluta ni afirmaci√≥n legal. *</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="legal-2" name="legal-check" onchange="verificarAceptacionLegal()">
                        <label for="legal-2">Declaro que este testimonio se basa en una experiencia personal y asumo toda responsabilidad por la informaci√≥n enviada. Entiendo que esto NO es una acusaci√≥n legal. *</label>
                    </div>
                    
                    <div class="verification-group" id="verification-group">
                        <div class="status-title">
                            <span style="color: #4CAF50;">üîí</span> Verificaci√≥n de Seguridad
                        </div>
                        <div class="status-badge" id="status-badge">
                            <svg id="badge-icon-check" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            <span id="badge-text">Publicaci√≥n Inhabilitada</span>
                        </div>

                        <div class="verification-status-box" id="verification-status-box">
                            <div class="status-text" id="verification-status-text">
                                ‚ùå Pendiente de Aceptaci√≥n de T√©rminos
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-publish" id="publish-btn" disabled>
                        üî• Publicar Reporte de Infidelidad
                    </button>
                    <div class="publish-note">Al publicar, aceptas que la informaci√≥n es veraz y ser√° visible p√∫blicamente.</div>
                </div>
            </form>
        </div>
    </div>
    
    <div id="not-found-modal" class="modal">
        <div class="modal-content not-found-modal-content">
            <span class="close-btn" onclick="cerrarModal('not-found-modal')">&times;</span>
            <div class="clean-status">
                <span>‚úÖ</span> ¬°LIMPIO/A! <span>‚úÖ</span>
            </div>
            <div class="shield-icon">
                <svg width="40" height="40" viewBox="0 0 24 24"><path d="M12 2L3 6v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V6l-9-4zm0 18c-3.83-1.07-6-5.87-6-10.74v-4.14l6-2.66 6 2.66v4.14c0 4.87-2.17 9.67-6 10.74zm2-11h-4v2h4v-2zm-2-2h-2v4h2v-4z" fill="#4CAF50"/></svg>
            </div>
            <div class="green-light">
                üíö ¬°Verde luz!... por ahora
            </div>
            <div class="not-found-name" id="not-found-name-display">
                "nombre completo" no aparece en nuestra base de datos
            </div>
            <div class="absence-note">
                Pero recuerda: la ausencia de evidencia no es evidencia de ausencia ü§´
            </div>
            <div class="modal-actions">
                <button class="btn btn-search-other" onclick="window.location.reload()">
                    <span style="font-size: 18px;">üîç</span> Buscar otro/a
                </button>
                <button class="btn btn-close-nf" onclick="cerrarModal('not-found-modal')">
                    Cerrar ‚ùØ
                </button>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURACI√ìN DE AIRTABLE (REEMPLAZA CON TUS CREDENCIALES) ===
        // ‚ö†Ô∏è ADVERTENCIA DE SEGURIDAD: Para uso serio, esta API Key DEBE ser ocultada por un proxy o backend.
        const AIRTABLE_API_KEY = 'YOUR_API_KEY_HERE'; 
        const AIRTABLE_BASE_ID = 'YOUR_BASE_ID_HERE'; 
        const AIRTABLE_TABLE_NAME = 'Reportes'; // Aseg√∫rate que este nombre coincida con tu tabla en Airtable

        let infieles = []; 
        let currentOnlineCount = 60; 
        
        function actualizarContador() {
            document.getElementById('lista-count').textContent = infieles.length;
        }
        
        function actualizarOnlineCount() {
            const fluctuation = Math.floor(Math.random() * 5) - 2; 
            currentOnlineCount = Math.max(1, currentOnlineCount + fluctuation); 
            document.getElementById('online-count').textContent = currentOnlineCount;
        }

        // === FUNCI√ìN PARA CARGAR DATOS PERSISTENTES DESDE AIRTABLE (GET) ===
        async function cargarInfielesDesdeAirtable() {
            const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`;
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                    }
                });
                
                if (!response.ok) {
                    console.error("Respuesta HTTP fallida:", response.status, await response.text());
                    // Manejar la situaci√≥n de 404/401 si las credenciales son malas al cargar.
                    return; 
                }
                
                const data = await response.json();
                
                // Mapear los registros de Airtable a la estructura de tu matriz 'infieles'
                infieles = data.records.map(record => ({
                    id: record.id, // ID del registro para actualizar (PATCH)
                    nombre: record.fields.Nombre_Completo || 'Sin Nombre',
                    votos: record.fields.Votos || 0, 
                    distrito: record.fields.Distrito || 'Desconocido'
                }));

                // Una vez cargados, actualizamos la interfaz
                actualizarContador();
                renderizarTop3();
                
            } catch (error) {
                console.error("Error al cargar datos de Airtable:", error);
            }
        }

        function renderizarTop3() {
            const top3 = [...infieles].sort((a, b) => b.votos - a.votos).slice(0, 3);
            const container = document.getElementById('top-infieles-container');
            container.innerHTML = ''; 

            const getMedalIcon = (rank) => {
                if (rank === 1) return 'ü•á';
                if (rank === 2) return 'ü•à';
                if (rank === 3) return 'ü•â';
                return '';
            };

            const getMedalHTML = (infiel, rank) => {
                const medalClass = `medal-${rank}`;
                const icon = getMedalIcon(rank);
                return `
                    <div class="medal-card ${medalClass}">
                        <span class="medal-icon">${icon}</span>
                        <div class="medal-name">${infiel.nombre.toUpperCase()}</div>
                        <div class="medal-votes">${infiel.votos} Votos</div>
                        <div class="medal-district">${infiel.distrito.toUpperCase()}</div>
                    </div>
                `;
            };

            const getEmptySlotHTML = (rank) => {
                const icon = getMedalIcon(rank);
                let specialStyle = '';
                let nameContent = 'VACANTE';
                if (rank === 1) specialStyle = 'background: linear-gradient(145deg, #fff2c8, #ffe580); color: #8a7c1f;';
                if (rank === 2) specialStyle = 'background: linear-gradient(145deg, #f0f0f0, #e0e0e0); color: #7f8c8d;';
                if (rank === 3) specialStyle = 'background: linear-gradient(145deg, #ffb68c, #ff9b5e); color: #fff;';
                
                return `
                    <div class="medal-card empty-slot medal-${rank}" style="${specialStyle}">
                        <span class="medal-icon">${icon}</span>
                        <div class="medal-name">${nameContent}</div>
                        <div class="medal-votes">0 Votos</div>
                        <div class="medal-district" style="background-color: transparent; border: none; font-weight: normal;">---</div>
                    </div>
                `;
            };

            for (let i = 0; i < 3; i++) {
                if (top3[i]) {
                    container.innerHTML += getMedalHTML(top3[i], i + 1);
                } else {
                    container.innerHTML += getEmptySlotHTML(i + 1);
                }
            }
        }
        function verificarAceptacionLegal() {
            const legal1 = document.getElementById('legal-1').checked;
            const legal2 = document.getElementById('legal-2').checked;
            const btnPublish = document.getElementById('publish-btn');
            const statusBox = document.getElementById('verification-status-box');
            const statusText = document.getElementById('verification-status-text');
            const statusBadge = document.getElementById('status-badge');
            const badgeText = document.getElementById('badge-text');

            if (legal1 && legal2) {
                statusText.innerHTML = '‚úÖ Verificaci√≥n completada';
                statusBox.style.backgroundColor = '#ebf5ee'; 
                statusBox.style.border = '1px solid #c8e6c9';
                statusText.style.color = '#4CAF50';
                statusBadge.classList.add('enabled');
                badgeText.textContent = 'Publicaci√≥n Habilitada';
                btnPublish.disabled = false;

            } else {
                statusText.innerHTML = '‚ùå Pendiente de Aceptaci√≥n de T√©rminos';
                statusBox.style.backgroundColor = '#fef7f7'; 
                statusBox.style.border = '1px solid #c8e6c9'; 
                statusText.style.color = '#d35400';
            
                statusBadge.classList.remove('enabled');
                badgeText.textContent = 'Publicaci√≥n Inhabilitada';
                btnPublish.disabled = true;
            }
        }
        
        // === FUNCI√ìN PARA ENVIAR/ACTUALIZAR DATOS EN AIRTABLE (POST/PATCH) ===
        async function submitReporteCompleto() {
            if (document.getElementById('publish-btn').disabled) {
                 alert("Por favor, acepta ambos T√©rminos Legales para habilitar la publicaci√≥n.");
                 return;
            }
            const nombre = document.getElementById('report-nombre').value.trim();
            const apellido = document.getElementById('report-apellido').value.trim();
            const distrito = document.getElementById('report-distrito').value;
            const edad = document.getElementById('report-edad').value;
            const genero = document.getElementById('report-genero').value;
            // Testimonio ya no es obligatorio
            const testimonio = document.getElementById('report-testimonio').value.trim();
            const enlace = document.getElementById('report-enlace').value.trim();
            const email = document.getElementById('report-email').value.trim();
            
            // Generar nombre completo y normalizar para b√∫squeda
            const nombreCompleto = `${nombre} ${apellido}`;
            const nombreBusqueda = nombreCompleto.toLowerCase();
            
            // VALIDACI√ìN ACTUALIZADA: Solo campos obligatorios marcados con *
            if (!nombre || !apellido || distrito === 'Selecciona distrito') {
                alert("Por favor, rellena los campos obligatorios (Nombre, Apellido y Distrito) marcados con (*).");
                return;
            }

            // 1. Verificar si el infiel ya existe en la lista cargada de Airtable
            let existingInfiel = infieles.find(i => 
                i.nombre.toLowerCase() === nombreBusqueda && i.distrito === distrito
            );

            const base_url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`;

            try {
                let response;
                let isUpdate = false;
                
                if (existingInfiel) {
                    // =========================
                    // A. ACTUALIZAR (PATCH): Ya existe, solo incrementamos el voto
                    // =========================
                    isUpdate = true;
                    const nuevosVotos = existingInfiel.votos + 1;
                    const dataToUpdate = {
                        "fields": {
                            "Votos": nuevosVotos 
                        }
                    };

                    // Usamos PATCH para actualizar un registro espec√≠fico (requiere el ID en la URL)
                    response = await fetch(`${base_url}/${existingInfiel.id}`, { 
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(dataToUpdate) 
                    });

                } else {
                    // =========================
                    // B. CREAR (POST): Es un nuevo infiel
                    // =========================
                    const dataToCreate = {
                        "fields": {
                            // Aseg√∫rate que los nombres de los campos (ej: 'Nombre_Completo') coincidan con los de tu tabla en Airtable
                            "Nombre_Completo": nombreCompleto, 
                            "Distrito": distrito,
                            "Edad": parseInt(edad) || null,
                            "Genero": genero,
                            // Testimonio puede ser vac√≠o
                            "Testimonio": testimonio, 
                            "Enlace_Evidencia": enlace,
                            "Email_Contacto": email,
                            "Votos": 1 // Inicializar con un voto
                        }
                    };
                    
                    // Usamos POST para crear un nuevo registro
                    response = await fetch(base_url, {
                        method: 'POST', 
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(dataToCreate)
                    });
                }
                
                if (!response.ok) {
                    // Si hay un error, el error 404 ser√° capturado aqu√≠
                    throw new Error(`Error al enviar el reporte: ${response.status} - ${await response.text()}`);
                }
                
                // 2. Si la publicaci√≥n fue exitosa, recargamos toda la lista
                await cargarInfielesDesdeAirtable(); 
                
                cerrarModal('reportar-modal');
                alert(`¬°Gracias! El reporte de ${nombreCompleto} ha sido ${isUpdate ? 'actualizado' : 'enviado'} y se ha actualizado el conteo de votos.`);
                
                // 3. Limpieza del formulario y verificaci√≥n
                document.getElementById('report-form').reset();
                document.getElementById('testimonio-char-count').textContent = '0 caracteres (opcional)';
                document.getElementById('file-selection-info').textContent = 'Elegir archivos';
                verificarAceptacionLegal(); 

            } catch (error) {
                console.error("Error en la publicaci√≥n:", error);
                alert("Ocurri√≥ un error al intentar publicar el reporte. Int√©ntalo de nuevo. Detalle: " + error.message);
            }
        }
        
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.trim().toLowerCase();
                if (searchTerm) {
                    const found = infieles.some(infiel => infiel.nombre.toLowerCase().includes(searchTerm));

                    if (!found) {
                        document.getElementById('not-found-name-display').textContent = `"${searchTerm}" no aparece en nuestra base de datos`;
                        document.getElementById('not-found-modal').style.display = "block";
                    } else {
                        alert(`¬°${searchTerm} ENCONTRADO/A! Mostrando resultados en la lista...`);
                    }
                }
            }
        });
        
        document.getElementById('report-testimonio').addEventListener('input', function() {
            const currentLength = this.value.length;
            // Etiqueta para reflejar que es opcional
            document.getElementById('testimonio-char-count').textContent = `${currentLength} caracteres (opcional)`;
        });

        document.getElementById('file-upload').addEventListener('change', function() {
            let files = this.files;
            let infoElement = document.getElementById('file-selection-info');
            if (files.length === 0) {
                infoElement.textContent = 'Elegir archivos';
            } else if (files.length === 1) {
                infoElement.textContent = files[0].name;
            } else {
                infoElement.textContent = `${files.length} archivos seleccionados`;
            }
        });

        const reportarModal = document.getElementById("reportar-modal");
        const reportarBtn = document.getElementById("reportar-btn");

        reportarBtn.onclick = function() {
            reportarModal.style.display = "block";
            verificarAceptacionLegal(); 
        }

        function cerrarModal(modalId) {
             document.getElementById(modalId).style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == reportarModal) {
                cerrarModal('reportar-modal');
            }
            if (event.target == document.getElementById("not-found-modal")) {
                cerrarModal('not-found-modal');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Cargar los datos desde Airtable al inicio
            cargarInfielesDesdeAirtable(); 
            
            actualizarOnlineCount();
            setInterval(actualizarOnlineCount, 15000); 
        });

    </script>
</body>
</html>
